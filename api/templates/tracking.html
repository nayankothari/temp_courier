{% extends "base.html" %} {% load static %} {% block title %}Tracking{% endblock title %} {% block content %}
<div class="container mt-5">
    <div class="row mt-4">
        <div class="col-12 mt-4">
            <h4 class="text-center"></h4>
            <div class="table-responsive">
                <table class="table table-striped">
                    <!-- <thead>
                        <tr>
                            <th scope="col" class="text-center" colspan="2">Booking Detail</th>
                        </tr>
                    </thead> -->
                    <tbody>
                        <tr>
                            <th scope="row" colspan="2" class="tracking_head">Booking Detail</th>
                        </tr>
                        {% if only_and_only_drs == 1 %}
                        <tr>
                            <th scope="row">C.N. Number</th>
                            <td><b>{{ c_note_number }}</b></td>

                        </tr>
                        {% else %}
                        <tr>
                            <th scope="row">C.N. Number</th>
                            <td><b>{{ booking_details.c_note_number }}</b></td>

                        </tr>
                        {% endif %} {% if booking_details.ref_courier_name.type != 'Internal' %}
                        <tr>
                            <th scope="row">Ref. Number</th>
                            <td>{{ booking_details.ref_courier_number }}
                                <button type='button' id='copy_btn' class='border-0 bg-transparent text-primary copy_btn' data-sid="{{ booking_details.ref_courier_number }}" title="Copy to clipboard"><span id="cp_clipboard"><i class="bi bi-clipboard"></i></span></button>
                            </td>

                        </tr>
                        {% endif %} {% if only_and_only_drs == 1 %}
                        <tr>
                            <th scope="row">From Center</th>
                            <td>{{ from_destination }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <th scope="row">From Center</th>
                            <td>{{ booking_details.from_destination }}</td>
                        </tr>
                        {% endif %}
                        <tr>
                            <th scope="row">To Center</th>
                            <td><b>{{ booking_details.to_destination }}</b></td>
                        </tr>
                        {% if only_and_only_drs == 1 %}
                        <tr>
                            <th scope="row">Date/Time</th>
                            <td>{{ date | date:'d-m-Y' }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <th scope="row">Date/Time</th>
                            <td>{{ booking_details.doc_date }}</td>
                        </tr>
                        {% endif %} {% if only_and_only_drs == 1 %}
                        <tr>
                            <th scope="row">Receiver name</th>
                            <td>{{ receiver_name }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <th scope="row">Receiver name</th>
                            <td>{{ booking_details.receiver_name }}</td>
                        </tr>
                        {% endif %} {% if last_status.name == 'DELIVERED' %}
                        <tr>
                            <th scope="row" class="text-success">Current Status</th>
                            {% if user.is_authenticated %}
                            <td class="text-success"><b>{{ last_status }} By {{ dbd.delivery_boy_name }}, Contact: {{ dbd.mobile_number }}</b></td>
                            {% else %}
                            <td class="text-success"><b>{{ last_status }}</b></td>
                            {% endif %}
                        </tr>
                        {% elif last_status.name == 'PENDING' %}
                        <tr>
                            <th scope="row" class="text-success">Current Status</th>
                            {% if user.is_authenticated %}
                            <td class="text-danger"><b>{{ last_status }} By {{ dbd.delivery_boy_name }}, Contact: {{ dbd.mobile_number }}</b></td>
                            {% else %}
                            <td class="text-danger"><b>{{ last_status }}</b></td>
                            {% endif %}
                        </tr>
                        {% elif last_status.name == 'RETURN' %}
                        <tr>
                            <th scope="row" class="text-success">Current Status</th>
                            {% if user.is_authenticated %}
                            <td class="text-danger"><b>{{ last_status }} By {{ dbd.delivery_boy_name }}, Contact: {{ dbd.mobile_number }}</b></td>
                            {% else %}
                            <td class="text-danger"><b>{{ last_status }}</b></td>
                            {% endif %}
                        </tr>
                        {% elif last_status.name == 'UNDELIVERED' %}
                        <tr>
                            <th scope="row" class="text-success">Current Status</th>
                            {% if user.is_authenticated %}
                            <td class="text-danger"><b>{{ last_status }} By {{ dbd.delivery_boy_name }}, Contact: {{ dbd.mobile_number }}</b></td>
                            {% else %}
                            <td class="text-danger"><b>{{ last_status }}</b></td>
                            {% endif %}
                        </tr>
                        {% else %}
                        <tr>
                            <th scope="row">Current Status</th>
                            {% if user.is_authenticated %} {% if dbd.delivery_boy_name %}
                            <td><b>{{ last_status }} By {{ dbd.delivery_boy_name }}, Contact: {{ dbd.mobile_number }}</b></td>
                            {% else %}
                            <td><b>{{ last_status }}</b></td>
                            {% endif %} {% else %}
                            <td><b>{{ last_status }}</b></td>
                            {% endif %}
                        </tr>
                        {% endif %} {% if only_and_only_drs == 1 %}
                        <tr>
                            <th scope="row">Remarks/Receiver</th>
                            <td>{{ reason }}</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- For internal tracking Details -->

<div class="container">
    <div class="row mt-2">
        {% if booking_details.ref_courier_name.type == 'Internal' %}
        <div class="col-12">
            <div class="scrollme">
                <table class="table table-striped table-responsive">
                    <tbody>
                        <tr>
                            <th class="tracking_head" colspan="5">Tracking history</th>
                        </tr>
                        <tr>
                            <th>Date</th>
                            <th>From</th>
                            <th>To</th>
                            <th>Status</th>
                            <th>Remarks/Receiver</th>
                        </tr>

                        {% for track_his in tracking_history %}
                        <tr>
                            <td>{{ track_his.in_out_datetime|date:"Y-m-d" }}</td>
                            {% if track_his.status.name == 'IN' %}
                            <td></td>
                            {% else %}
                            <td>{{ track_his.d_from }}</td>
                            {% endif %}
                            <td>{{ track_his.d_to }}</td>
                            <td>{{ track_his.status }}</td>
                            {% if track_his.remarks %}
                            <td>{{ track_his.remarks }}</td>
                            {% else %}
                            <td></td>
                            {% endif %}
                        </tr>
                        {% endfor %} {% if drs_details == 1 %}
                        <tr>
                            <td>{{ date|date:"Y-m-d" }}</td>
                            <td>{{ track_his.d_from }}</td>
                            <td>{{ track_his.d_to }}</td>
                            {% if user.is_authenticated %}
                            <td><b>{{ status }} | Delivery boy: {{ dbd.delivery_boy_name }}, Contact: {{ dbd.mobile_number }}</b></td>
                            {% else %}
                            <td><b>{{ status }}</b></td>
                            {% endif %} {% if reason %}
                            <td>{{ reason }}</td>
                            {% else %}
                            <td>{{ reason }}</td>
                            {% endif %}
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
        {% else %}
        <!-- For external tracking details-->
        <div class="col-12">
            <div class="scrollme">
                <table class="table table-striped table-responsive">
                    <tbody id="collected_tbody">
                        <tr>
                            <th class="tracking_head" colspan="5">Tracking Details</th>
                        </tr>
                        <tr>
                            <th>Date</th>
                            <th>From</th>
                            <th>To</th>
                            <th>Status</th>
                        </tr>

                        {% for track_his in tracking_history %}
                        <tr>
                            <td>{{ track_his.Date }}</td>
                            <td>{{ track_his.Location }}</td>
                            <td>{{ track_his.Activity | safe}}</td>
                            <td>{{ track_his.CheckpointState }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        {% endif %}
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12 text-center mb-3 mt-3">
                    <a href="{% url 'home' %}"><button type="button" class="btn btn-outline-primary">Back to Home</button></a>
                </div>
            </div>
        </div>
    </div>
</div>
{% include 'tracking_ajax.html' %} {% endblock content %}